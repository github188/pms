<!DOCTYPE html>
<html>
  <head>
    <title>org_maintain.html</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-language" content="zh_CN" />
	<meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    	

    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
  </head>
  
  <body>
    <div class="easyui-layout" data-options="fit:true,border:false">
    	<div region="north" data-options="split:false,border:true"  style="height:45px;line-height:42px;padding-left:5px;background: url(../images/white-top-bottom.gif) repeat-x;">
    		<b>当前位置：<span style="color:blue">机构维护</span></b>
    	</div><!-- end of north -->
    	<div region="west" data-options="split:false,border:true,noheader:true" style="width:200px;padding:3px">
    		<div class="easyui-panel" data-options="fit:true,border:true,noheader:true">
	        <ul id="org_maintain_tree" class="easyui-tree" data-options="url:'../organization/queryChildrenNodes.action'">
	        </ul><!-- end of org_maintain_tree -->
	        </div>
	    </div><!-- end of west -->
	    <div id="content" region="center" data-options="border:true,noheader:true" style="padding:3px;">
 	    	<div id="org_maintain_center_main_wapper" class="easyui-panel" data-optainons="border:false,fit:true,maximizable:true,closed:false,height:'100%'">
	    	<div id="org_maintain_center_main" class="easyui-layout" data-options="fit:true" >
	    	
	    		<div id="org_maintain_center_query" region="north" data-options="border:false,noheader:true" style="margin-bottom:5px;">
	    			<table style="width:100%">
		                <tr>
		                    <td class="query_name_small text_right">机构名称</td>
		                    <td class="query_value_small"><input id="org_name" class="easyui-textbox"></input></td>
		                    <td class="query_name_small text_right">机构编码</td>
		                    <td class="query_value_small"><input id="org_uid" class="easyui-textbox"></input></td>
		                    <td class="query_name_small noborder">
		                    	<a href="javascript:void(0)" class="easyui-linkbutton detail_query_button" data-options="plain:true,iconCls:'icon-detail'" onclick="toggleDetailQuery()" style="height:24px;">高级查询</a>
		                    </td>
		                    <td class="text_right noborder">
		                    	<a href="javascript:void(0)" class="easyui-linkbutton" onclick="queryOrg()">查询</a>
            					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearQueryOrgCondition()">重置</a>
		                    </td>
		                </tr>
		            </table>
		            <table class="detail_query noborder" style="width:100%;display:none;">
		                <tr>
		                    <td class="detail_query_name text_right">公安组织机构级别</td>
		                    <td class="detail_query_value"><input id="org_level" class="easyui-textbox query_value_mid"></input></td>
		                    <td>
		                </tr>
		            </table>
	    		</div><!-- end of org_maintain_center_query -->
	    		
	    		<div id="org_maintain_center_list" region="center" data-options="border:false,noheader:true" >
	    			<table id="org_maintain_center_list_dg"  
				            data-options="singleSelect:false,method:'post',nowrap:true,idField:'id',toolbar:'#toolbar',pagination:true,noheader:true,fit:true">
				        <thead>
				            <tr>
				            	<th field="ck" checkbox="true"></th>
				                <th data-options="field:'name'" style="width:33%;">机构名称</th>
				                <th data-options="field:'uid'" style="width:33%;">机构编码</th>
				                <th data-options="field:'orgLevel'" style="width:33%;">上级机构</th>
				            </tr>
				        </thead>
				    </table>
				    <div id="toolbar" style="background-color:#E7F0FF">
				    	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="addOrg();">增加</a>
            			<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" >修改</a>
            			<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" >删除</a>
				    </div><!-- end of toolbar -->
	    		</div><!-- end of org_maintain_center_list -->
	    		
	    	</div><!-- end of org_maintain_center_main -->
	    	</div><!-- org_maintain_center_main_wapper -->
	    	<div id="org_maintain_center_detail" class="easyui-panel" data-options="fit:true,closed:true" >
	    		<b>当前位置：<span style="color:blue">机构维护</span></b>
	    		<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" onclick="addOrgReturn();">返回</a>
	    	</div><!-- end of org_maintain_center_detail -->
	    </div><!-- end of center -->
    
    </div><!-- end of layout -->
    <script>
    var isDetailQuery = false;
    function toggleDetailQuery(obj){
    	var currentHeight = $("#org_maintain_center_main").layout('panel','north').height();
    	if( currentHeight > 29 ) {
    		$(".detail_query").hide();
    		$('.detail_query_button').linkbutton({iconCls: 'icon-detail', text:'高级查询'});
    		isDetailQuery = false;
    		$("#org_maintain_center_main").layout('panel','north').panel('resize', {height:29}) ;
    	}
    	else {
    		$(".detail_query").show();
    		$('.detail_query_button').linkbutton({iconCls: 'icon-simple', text:'简单查询'});
    		isDetailQuery = true;
    		$("#org_maintain_center_main").layout('panel','north').panel('resize', {height:58}) ;
    	}
    	
    	$("#org_maintain_center_main").layout('resize',{width:'100%',height:'100%'});
    }
    
    function queryOrg(){
    	var treeNode = $('#org_maintain_tree').tree('getSelected');
    	var treeNodeId = "";
    	if( treeNode != null ) {
    		treeNodeId = treeNode.id;
    	}
    	var name = $("#org_name").val();
    	var uid = $("#org_uid").val();
    	var level = "";
    	if( isDetailQuery ) {
    		level = $("#org_level").val();
    	}
    	$("#org_maintain_center_list_dg").datagrid('load',{
    		queryAll: true,
			id: treeNodeId,
			orgName: name,
			orgUid: uid,
			orgLevel: level
		});
    }
    
    function clearQueryOrgCondition(){
    	$("#org_name").textbox({value:""});
    	$("#org_uid").textbox({value:""});
    	$("#org_level").textbox({value:""});
    }
    
    function addOrg(){
    	$("#org_maintain_center_main_wapper").panel('close');
    	$("#org_maintain_center_detail").panel('open');
    }
    
    function addOrgReturn(){
    	$("#org_maintain_center_main_wapper").panel('open');
    	$("#org_maintain_center_detail").panel('close');
    }
$(document).ready(function () { 
	$('#org_maintain_tree').tree({
	    loadFilter: function(data){
	        if (data.treeNodes){
	            return data.treeNodes;
	        } else {
	            return data;
	        }
	    },
	    onClick: function(node){
	    	//alert(node.id);
	    	$("#org_maintain_center_list_dg").datagrid('load',{
				id: node.id
			});
	    }
	});
	
	$("#org_maintain_center_list_dg").datagrid({
		url:'../organization/queryChildrenItems.action',
		loadFilter: function(data){
			var res = new Object();
			if (data.result == true){
				res.total = data.total;
				res.rows = data.items;
			} else {
				res.total=0;
				res.rows = [];
			}
			return res;
		},
//		onLoadSuccess: function() {alert("success");},
		onLoadError: function() { $("#org_maintain_center_main").layout('resize',{width:'100%',height:'100%'}); }
	});
	$("#org_maintain_center_list_dg").datagrid('getPager').pagination({	// change options and refresh pager bar information
			beforePageText: '第',    	
			afterPageText:'页，共 {pages}页',
			displayMsg:'显示 {from}到 {to} 条记录，共 {total}记录'
	});
});
    </script>
  </body>
</html>
