<!DOCTYPE html>
<html>
  <head>
    <title>group_user_maintain.html</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    
    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->

  </head>
  
  <body>
	<div class="easyui-layout" data-options="fit:true,border:false">
		<div region="north" data-options="split:false,border:true"  style="height:45px;line-height:42px;padding-left:5px;background: url(../images/white-top-bottom.gif) repeat-x;">
			<b>当前位置：<span style="color:blue">离散群体维护</span></b>
		</div>
		<div id="content" region="center" data-options="border:true,noheader:true" style="padding:3px;">
			<div id="group_user_maintain_center_main_wapper" class="easyui-panel" data-options="border:false,fit:true">
				<div id="group_user_maintain_center_main" class="easyui-layout" data-options="fit:true" >
					<div id="group_user_maintain_center_query" region="north" data-options="border:false,noheader:true" style="margin-bottom:5px;">
		    			<table class="nodt" style="width:100%">
			                <tr>
			                    <td class="query_name_small text_right">名称</td>
			                    <td class="query_value_small"><input id="group_user_query_name" class="easyui-textbox"></input></td>
			                    <td class="query_name_small text_right">编码</td>
			                    <td class="query_value_small"><input id="group_user_query_code" class="easyui-textbox"></input></td>
			                    <td>
			                    	<a href="javascript:void(0)" class="easyui-linkbutton" onclick="queryUserGroup()">查询</a>
	            					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearQueryUserGroupCondition()">重置</a>
			                    </td>
			                </tr>
			            </table>
		    		</div><!-- end of group_user_maintain_center_query -->
		    		
		    		<div id="group_user_maintain_center_list" region="center" data-options="border:false,noheader:true" >
		    			<table class="nodt" id="group_user_maintain_center_list_dg"  
					            data-options="singleSelect:false,method:'post',nowrap:true,toolbar:'#toolbar',pagination:true,noheader:true,fit:true">
					        <thead>
					            <tr>
					            	<th field="ck" checkbox="true"></th>
					                <th data-options="field:'name'" style="width:33%;">名称</th>
					                <th data-options="field:'code'" style="width:33%;">编码</th>
					                <th data-options="field:'describ'" style="width:33%;">描述</th>
					            </tr>
					        </thead>
					    </table>
					    <div id="toolbar" style="background-color:#E7F0FF">
					    	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="addGroupOfUser()">添加</a>
	            			<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" onclick="modGroupOfUser()">修改</a>
	            			<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="delGroupOfUser()">删除</a>
	            			
					    </div><!-- end of toolbar -->
		    		</div><!-- end of group_user_maintain_center_list -->
		    	</div><!-- end of group_user_maintain_center_main -->
			</div><!-- group_user_maintain_center_main_wapper -->
			
			<div id="group_user_maintain_center_detail_wapper" class="easyui-panel" data-options="fit:true,closed:true" >
				<div id="group_user_maintain_center_detail" class="easyui-panel" 
								data-options="fit:true,border:false,title:'基本信息',footer:'#group_user_maintain_center_detail_ft'" >
					<div id="message" style="width=100%;height:30px;text-align:center;line-height:30px;display:none"></div>
					<input id="group_user_id" type="hidden"/> 
			        <table class="nodt" style="width:100%">
			            <tr>
			                <td class="form_name_small text_right"><span style="color:red;">*</span> 离散群体名称</td>
			                <td><input id="group_user_name" class="form_value_mid easyui-textbox" data-options="prompt:'请输入离散群体名称'"></input></td>
			            </tr>
			            <tr>
			                <td class="form_name_small text_right"><span style="color:red;">*</span> 离散群体编码</td>
			                <td><input id="group_user_code" class="form_value_mid easyui-textbox" data-options="prompt:'请输入离散群体编码'"></input></td>
			            </tr>
			            <tr>
			                <td class="form_name_small text_right"> 描述</td>
			                <td><input id="group_user_describe" class="form_value_mid easyui-textbox" data-options="prompt:'请输入描述'"></input></td>
			            </tr>
					</table>

					<table class="nodt" id="group_user_list_dg" >
				    </table>
				    <div id="listToolbar" style="background-color:#E7F0FF">
				    	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="openGroupDetailQueryUserWin()">添加</a>
				    </div><!-- end of listToolbar -->
				    
				    				    
				</div><!-- end of group_user_maintain_center_detail -->
				<div id="group_user_maintain_center_detail_ft" style="text-align:center;height:45px;padding-top:15px;">
					<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="addGroupUserSave();">保存</a>
					<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="addGroupUserReturn();">返回</a>
				</div><!-- end of group_user_maintain_center_detail_ft -->
				
				<div id="group_user_query_user_win" class="easyui-window" title="查询用户" style="width:90%;height:90%;"
						data-options="iconCls:'icon-save',draggable:false,inline:true,modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false" >
					<div class="easyui-panel" data-options="fit:true,footer:'#group_user_query_user_win_ft'">
						
						<div class="easyui-layout" data-options="fit:true,border:false">	
							<div region="west" data-options="split:false,border:true,noheader:true" style="width:200px;padding:3px">
					    		<div class="easyui-panel" data-options="fit:true,border:true,noheader:true">
						        <ul id="group_user_query_user_win_tree" class="easyui-tree" data-options="url:'../organization/queryChildrenNodes.action'">
						        </ul><!-- end of group_user_query_user_win_tree -->
						        </div>
						    </div><!-- end of group_user_query_user_win_west -->
						    <div region="center" data-options="border:true,noheader:true" style="padding:3px;">
						    	<div id="group_user_query_user_win_center_main" class="easyui-layout" data-options="fit:true" >
						    		<div id="group_user_query_user_win_center_query" region="north" data-options="border:false,noheader:true" style="margin-bottom:5px;">
						    			<table class="nodt" style="width:100%">
							                <tr>
							                    <td class="query_name_small text_right" style="width:10%;">姓名</td>
							                    <td class="query_value_small" style="width:10%;"><input id="group_user_query_user_win_query_name" class="easyui-textbox"></input></td>
							                    <td class="query_name_small text_right" style="width:10%;">状态</td>
							                    <td class="query_value_small" style="width:10%;" ><input id="group_user_query_user_win_query_status" value="0" style="width:150px;"></input></td>
							                    <td class="query_name_small noborder" style="border:0;">
							                    	<a href="javascript:void(0)" class="easyui-linkbutton detail_query_button" data-options="plain:true,iconCls:'icon-detail'" onclick="toggleDetailQuery()" style="height:24px;">高级查询</a>
							                    </td>
							                    <td class="text_right noborder" style="border:0;">
							                    	<a href="javascript:void(0)" class="easyui-linkbutton" onclick="groupUserQueryUserWinQueryUser()">查询</a>
					            					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="cleargroupUserQueryUserWinQueryUserCondition()">重置</a>
							                    </td>
							                </tr>
							            </table>
							            <table class="detail_query noborder nodt" style="width:100%;display:none;border:0;">
							                <tr>
							                    <td class="detail_query_name text_right">业务部门类别</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_businesstype" class="easyui-textbox query_value_mid"></input></td>
							                    <td class="detail_query_name text_right">警种</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_police_type" class="easyui-textbox query_value_mid"></input></td>	
							                </tr>
							                <tr>
							                    <td class="detail_query_name text_right">性别</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_sex" class="easyui-textbox query_value_mid"></input></td>
							                    <td class="detail_query_name text_right">身份证</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_idnum" class="easyui-textbox query_value_mid"></input></td>	
							                </tr>
							                <tr>
							                    <td class="detail_query_name text_right">最高敏感级别</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_max_sensitive_level" class="easyui-textbox query_value_mid"></input></td>
							                    <td class="detail_query_name text_right">岗位</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_position" class="easyui-textbox query_value_mid"></input></td>	
							                </tr>
							                <tr>
							                    <td class="detail_query_name text_right">二级部门</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_dept" class="easyui-textbox query_value_mid"></input></td>
							                    <td class="detail_query_name text_right">职务/职称</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_title" class="easyui-textbox query_value_mid"></input></td>	
							                </tr>
							                <tr>
							                    <td class="detail_query_name text_right">警号</td>
							                    <td class="detail_query_value"><input id="group_user_query_user_win_query_police_num" class="easyui-textbox query_value_mid"></input></td>
							                </tr>
							            </table>
						    		</div><!-- end of group_user_query_user_win_center_query -->
						    		
						    		<div id="group_user_query_user_win_center_list" region="center" data-options="border:false,noheader:true" >
						    			<table class="nodt" id="group_user_query_user_win_center_list_dg"  
									            data-options="singleSelect:false,method:'post',nowrap:true,idField:'id',pagination:true,noheader:true,fit:true">
									        <thead>
									            <tr>
									            	<th field="ck" checkbox="true"></th>
									                <th data-options="field:'name'" style="width:25%;">姓名</th>
									                <th data-options="field:'pname'" style="width:25%;">组织机构</th>
									                <th data-options="field:'gname'" style="width:25%;">上级机构</th>
									                <th data-options="field:'certificate_code_md5'" hidden="true">身份证哈希值</th>
									                <th data-options="field:'status',formatter:formatStatus" style="width:25%;">状态</th>
									            </tr>
									        </thead>
									    </table>
									    
						    		</div><!-- end of group_user_query_user_win_center_list -->
						    		
						    	</div><!-- end of group_user_query_user_win_center_main -->
						    </div><!-- end of group_user_query_user_win_center -->
						</div>
						
					</div>
					<div id="group_user_query_user_win_ft" style="padding:5px;text-align:center">
				        <a href="javascript:void(0)" class="easyui-linkbutton" style="width:80px;" onclick="groupUserQueryUserWinConfirm();">确定</a>
                    	<a href="javascript:void(0)" class="easyui-linkbutton" style="width:80px;" onclick="groupUserQueryUserWinReturn();">返回</a>
				    </div>
				</div><!-- end of group_user_query_user_win -->
	    	</div><!-- end of group_user_maintain_center_detail_wapper -->
	    			
		</div><!-- end of center -->
	</div><!-- end of layout -->
<script>
	function queryUserGroup(){
    	var name = $("#group_user_query_name").val();
    	var code = $("#group_user_query_code").val();

    	$("#group_user_maintain_center_list_dg").datagrid('load',{
    		queryAll: true,
			groupName: name,
			groupCode: code
		});
    }
    
    function clearQueryUserGroupCondition(){
    	$("#group_user_query_name").textbox({value:""});
    	$("#group_user_query_code").textbox({value:""});
    }
    
    var isDetailQuery = false;
    function toggleDetailQuery(){
    	var currentHeight = $("#group_user_query_user_win_center_main").layout('panel','north').height();
    	if( currentHeight > 29 ) {
    		$(".detail_query").hide();
    		$('.detail_query_button').linkbutton({iconCls: 'icon-detail', text:'高级查询'});
    		isDetailQuery = false;
    		$("#group_user_query_user_win_center_main").layout('panel','north').panel('resize', {height:29}) ;
    	}
    	else {
    		$(".detail_query").show();
    		$('.detail_query_button').linkbutton({iconCls: 'icon-simple', text:'简单查询'});
    		isDetailQuery = true;
    		$("#group_user_query_user_win_center_main").layout('panel','north').panel('resize', {height:116}) ;
    	}
    	
    	$("#group_user_query_user_win_center_main").layout('resize',{width:'100%',height:'100%'});
    }
    
    function groupUserQueryUserWinQueryUser(){
    	var treeNode = $("#group_user_query_user_win_tree").tree('getSelected');
    	var treeNodeId = "";
    	if( treeNode != null ) {
    		treeNodeId = treeNode.id;
    	}
    	var name = $("#group_user_query_user_win_query_name").val();
    	var status = $("#group_user_query_user_win_query_status").combobox("getValue");
    	
    	var businesstype = "";
    	var policeType = "";
    	var sex = "";
    	var idnum = "";
    	var maxSensitiveLevel = "";
    	var position = "";
    	var dept = "";
    	var title = "";
    	var policeNum = "";
    	if( isDetailQuery ) {
    		businesstype = $("#group_user_query_user_win_query_businesstype").combobox("getValue");
    		policeType = $("#group_user_query_user_win_query_police_type").combobox("getValue");
    		sex = $("#group_user_query_user_win_query_sex").combobox("getValue");
    		idnum = $("#group_user_query_user_win_query_idnum").val();
    		maxSensitiveLevel = $("#group_user_query_user_win_query_max_sensitive_level").combobox("getValue");
    		position = $("#group_user_query_user_win_query_position").val();
    		dept = $("#group_user_query_user_win_query_dept").val();
    		title = $("#group_user_query_user_win_query_title").val();
    		policeNum = $("#group_user_query_user_win_query_police_num").val();
    	}
    	$("#group_user_query_user_win_center_list_dg").datagrid('load',{
    		queryAll: true,
			id: treeNodeId,
			userName: name,
			userStatus: status,
			userbusinesstype: businesstype,
			userPoliceType: policeType,
			userSex: sex,
			userIdnum: idnum,
			userMaxSensitiveLevel: maxSensitiveLevel,
			userPosition: position,
			userDept: dept,
			userTitle: title,
			userPoliceNum: policeNum
		});
		toggleDetailQuery();
    }
    
    function cleargroupUserQueryUserWinQueryUserCondition(){
    	$("#group_user_query_user_win_query_name").textbox({value:""});
    	$("#group_user_query_user_win_query_status").combobox("setValue","0");
    	
    	$("#group_user_query_user_win_query_businesstype").textbox({value:""});
    	$("#group_user_query_user_win_query_police_type").textbox({value:""});
    	$("#group_user_query_user_win_query_sex").textbox({value:""});
    	$("#group_user_query_user_win_query_idnum").textbox({value:""});
    	$("#group_user_query_user_win_query_max_sensitive_level").textbox({value:""});
    	$("#group_user_query_user_win_query_position").textbox({value:""});
    	$("#group_user_query_user_win_query_dept").textbox({value:""});
    	$("#group_user_query_user_win_query_title").textbox({value:""});
    	$("#group_user_query_user_win_query_police_num").textbox({value:""});
    }
    
    function formatStatus(val,row){
		if (val == 0){
			return "正常";
		} else if (val == 1) {
			return "注销";
		}
		else {
			return "未知状态";
		}
	}

//--------------------------------------------------------------------------------
	function addGroupOfUser() {
		$("#group_user_maintain_center_main_wapper").panel('close');
    	$("#group_user_maintain_center_detail_wapper").panel('open');
	}
	
	function addGroupUserReturn() {
		$("#group_user_maintain_center_list_dg").datagrid('clearSelections');
    	$("#group_user_maintain_center_main_wapper").panel('open');
    	$("#group_user_maintain_center_main_wapper").panel('resize');
    	$("#group_user_maintain_center_detail_wapper").panel('close');
    	refreshDetailPage();
    }
    
    function refreshDetailPage() {
		$("#group_user_id").val("");
     	$("#group_user_name").textbox('setValue',"");
     	$("#group_user_code").textbox('setValue',"");
     	$("#group_user_describe").textbox('setValue',"");
     	
     	//clear datagrid's data
      	$("#group_user_list_dg").datagrid({data: []});
    }
    
    function addGroupUserSave() {
    	var groupId = $("#group_user_id").val();
    	var groupName = $("#group_user_name").textbox('getValue');
    	
    	if(groupId.length == 0){
    		var poststr = "group.name=" + groupName;
    	}else{
	    	var poststr = "group.id=" + groupId;
	    	poststr += "&group.name=" + groupName;
    	}
    	
    	var groupCode = $("#group_user_code").textbox('getValue');
    	poststr += "&group.code=" + groupCode;
    	
    	var groupDescrib = $("#group_user_describe").textbox('getValue');
    	poststr += "&group.describ=" + groupDescrib;
    	
     	var rows = $("#group_user_list_dg").datagrid('getRows');
     	var index = 0;
    	for(index=0; index < rows.length; index++) {
	 		poststr += '&addUserIds=' + rows[index].certificate_code_md5;
    	}
		
    	$.post("../group/saveGroupUser.action?rand=" + Math.random(), poststr, function(retObj) {
		
			if(retObj.result == true)
			{
				$("#group_user_maintain_center_list_dg").datagrid('reload').datagrid('clearSelections');
				successTip("提示", '保存离散群体信息成功');
			}
			else
			{
				warningTip("提示", '保存离散群体信息失败');	
			}
			addGroupUserReturn();
		}, "json");
    }
    
    function openGroupDetailQueryUserWin(){
    	$("#group_user_query_user_win").window({title:'查询用户'}).window('open').window('center');
    }
    
    function groupUserQueryUserWinReturn() {
    	$("#group_user_query_user_win_center_list_dg").datagrid('clearSelections');
    	$("#group_user_query_user_win").window('close');
    }
	
	function isExist(data, id) {
    	for(var index = 0; index<data.length; index++) {
    		if(data[index].id == id)
    			return true;
    	}
    	return false;
    }
	function insertUser( data ){
		var rows = $("#group_user_list_dg").datagrid('getRows');
		var index = rows.length;
		
		if( isExist( rows, data.id ) )
			return;
			
    	$("#group_user_list_dg").datagrid('insertRow', {
			index: index,
			row:{
				id:data.id, 
				name:data.name, 
				pname:data.pname, 
				gname:data.gname,
				certificate_code_md5:data.certificate_code_md5
			}
		});
	}
	
	function groupUserDeleterow( target ) {
		$.messager.confirm('Confirm','Are you sure?',function(r){
			if (r){
				$("#group_user_list_dg").datagrid('deleteRow', getRowIndex(target));
			}
		});
	}
	
	function groupUserQueryUserWinConfirm() {
		var rows = $("#group_user_query_user_win_center_list_dg").datagrid('getSelections');
		//alert(rows.length + "|" + rows[0].max_sensitive_level);
		for( var index=0; index<rows.length; index++ ) {
	    	insertUser(rows[index]);
    	}
    	return groupUserQueryUserWinReturn();
	}
	
	function isExist(data, id) {
    	for(var index = 0; index<data.length; index++) {
    		if(data[index].id == id)
    			return true;
    	}
    	return false;
    }
	function insertUsers( data ){
		var rows = $("#group_user_list_dg").datagrid('getRows');
		var index = rows.length;
		
		if( isExist( rows, data.id ) )
			return;
		//for(data.)
    	$("#group_user_list_dg").datagrid('insertRow', {
			index: index,
			row:{
				id:data.id, 
				name:data.name, 
				pname:data.pname, 
				gname:data.gname,
				certificate_code_md5:data.certificate_code_md5
			}
		});
	}
	
	function modGroupOfUser() {
		var rows = $("#group_user_maintain_center_list_dg").datagrid('getSelections');
		if(rows.length == 0) {
			warningTip("提示", '请选择要修改的群体');
			return false;
		} else if (rows.length>1)
		{
			warningTip("提示", '一次只能修改一个群体');
			return false;
		}
		
		$("#group_user_id").val(rows[0].id);
		$("#group_user_name").textbox('setValue',rows[0].name);
		$("#group_user_code").textbox('setValue',rows[0].code);
		$("#group_user_describe").textbox('setValue',rows[0].describ);
		
		
		//load datagrid's data
		var poststr = "group.code=" + rows[0].code;
		$.post("../group/queryGroupUsers.action?rand=" + Math.random(), poststr, function(retObj) {
		
			if(retObj.result == true)
			{
 				var index;
 				for( index=0; index < retObj.users.length; index++) {
 					insertUsers( retObj.users[index]);
 				}
			}
			else
			{
				warningTip("提示", '获取离散群体的用户信息失败');	
				refreshDetailPage();
				return;
			}
		}, "json");
		
   		$("#group_user_maintain_center_main_wapper").panel('close');
    	$("#group_user_maintain_center_detail_wapper").panel('open');
	}
	
	function delGroupOfUser() {
		var rows = $("#group_user_maintain_center_list_dg").datagrid('getSelections');
		if(rows.length == 0) {
			warningTip("提示", '请选择要删除的群体');
			return;
		}
		else {
			$.extend($.messager.defaults,{  
				ok:"删除",  
				cancel:"取消"  
			});
			$.messager.confirm('确认', '您选取了' + rows.length + '条记录。确认要删除所选群体？', function(r){
                if (r){
                	var poststr = "delIds=" + rows[0].code;
                	for(var i=1; i<rows.length; i++){
					    poststr += "&delIds=" + rows[i].code;
					}

                    $.post("../group/deleteGroupUsers.action", poststr, function(retObj) {
		
						if(retObj.result == true)
						{
							$("#group_user_maintain_center_list_dg").datagrid('reload').datagrid('clearSelections');
							successTip("删除群体","操作成功");
						}
						else
						{
							warningTip("提示", "删除群体操作失败：" + retObj.message);
						}
					}, "json");
                }
            });
		}
	}
	
	//------------------for value edit datagrid-------
	function getRowIndex(target){
		var tr = $(target).closest('tr.datagrid-row');
		return parseInt(tr.attr('datagrid-row-index'));
	}
	
$(document).ready(function () { 
	
	$("#group_user_query_user_win_tree").tree({
	    loadFilter: function(data){
	        if (data.treeNodes){
	            return data.treeNodes;
	        } else {
	            return data;
	        }
	    },
	    onClick: function(node){
	    	//alert(node.id);
	    	$("#group_user_query_user_win_center_list_dg").datagrid('load',{
				id: node.id
			});
	    }
	});
	
	$("#group_user_query_user_win_query_status").combobox({
		valueField: 'value',
		textField: 'label',
		editable:false,
		data:[{
			label: '请选择',
			value: '',
		},{
			label: '正常',
			value: '0'
		},{
			label: '注销',
			value: '1'
		}]
	});
	
	$("#group_user_query_user_win_center_list_dg").datagrid({
		url:'../user/queryUserItems.action',
		queryParams:{queryAll: true},
		loadFilter: function(data){
			var res = new Object();
			if (data.result == true){
				res.total = data.total;
				res.rows = data.items;
			} else {
				res.total=0;
				res.rows = [];
			}
			return res;
		},
//		onLoadSuccess: function() {alert("success");},
		onLoadError: function() { $("#group_user_query_user_win_center_main").layout('resize',{width:'100%',height:'100%'}); }
	});
	
//--------------------------------------------------------------------------------------------------------------------	
	$("#group_user_maintain_center_list_dg").datagrid({
		url:'../group/queryGroupUserItems.action',
		loadFilter: function(data){
			var res = new Object();
			if (data.result == true){
				res.total = data.total;
				res.rows = data.items;
			} else {
				res.total=0;
				res.rows = [];
			}
			return res;
		},
//		onLoadSuccess: function() {alert("success");},
		onLoadError: function() { $("#group_user_maintain_center_main").layout('resize',{width:'100%',height:'100%'}); }
	});

	$("#group_user_list_dg").datagrid({
		title:'用户列表',
		iconCls:'icon-edit',
		nowrap:true,
		fit:true,
		toolbar:'#listToolbar',
		singleSelect:true,
		pagination:false,
		idField:'id',
		columns:[[
			{field:'name',title:'姓名',width:'30%',editor:'text'},
			{field:'pname',title:'组织机构',width:'30%',editor:'text'},
			{field:'gname',title:'上级机构',width:'30%',editor:'text'},
			{field:'certificate_code_md5',title:'身份证哈希值',editor:'text',hidden:'true'},
			{field:'action',title:'操作',width:'10%',align:'center',
				formatter:function(value,row,index){
					return '<a href="#" onclick="groupUserDeleterow(this)">删除</a>';
				}
			}
		]]
	});
	
	$.post("../system/queryUserAttrs.action", function(data) {
		var sex="";						//性别
		var police_type="";				//警种
		//var police_num="";				//警号
		var max_sensitive_level="";		//最高敏感级别
		var businesstype="";			//业务部门类别
		//var title="";					//职务/职称
		
		for( var index in data.items ) {
			for(var i=0;i<data.items[index].dictionary.length;i++){
				if( "SEXCODE" == data.items[index].code ) {
					sex += "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},";
				}
				else if( "POLICE_SORT" == data.items[index].code ) {
					police_type += "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
				}
				else if( "SENSITIVE_LEVEL" == data.items[index].code ) {
					max_sensitive_level += "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},";
				}
				else if( "BUSINESS_TYPE" == data.items[index].code ) {
					businesstype += "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},";
				}
// 				else if( "POLICE_NO" == data.items[index].code ) {
// 					police_num += "{id:'"+data.items[2].dictionary[i].code+"',text:'"+data.items[2].dictionary[i].value+"'},"; 
// 				}
// 				else if( "TAKE_OFFICE" == data.items[index].code ) {
// 					title += "{id:'"+data.items[5].dictionary[i].code+"',text:'"+data.items[5].dictionary[i].value+"'},";
// 				}
			};
			
		}
		
		var sexData='([' + sex.substring(0,sex.length-1) + '])';
 		var sexJSON = (new Function('return '+sexData +';'))();
 		var police_typeData='([' + police_type.substring(0,police_type.length-1) + '])';
 		var police_typeJSON = (new Function('return '+police_typeData +';'))(); 
//  		var police_numData='([' + police_num.substring(0,police_num.length-1) + '])';
//  		var police_numJSON = (new Function('return '+police_numData +';'))(); 
 		var max_sensitive_levelData='([' + max_sensitive_level.substring(0,max_sensitive_level.length-1) + '])';
 		var max_sensitive_levelJSON = (new Function('return '+max_sensitive_levelData +';'))(); 
 		var businesstypeData='([' + businesstype.substring(0,businesstype.length-1) + '])';
 		var businesstypeJSON = (new Function('return '+businesstypeData +';'))(); 
//  		var titleData='([' + title.substring(0,title.length-1) + '])';
//  		var titleJSON = (new Function('return '+titleData +';'))();
 		
  		sexJSON.unshift({ "id": "", "text": "请选择" });
		police_typeJSON.unshift({ "id": "", "text": "请选择" });
//		police_numJSON.unshift({ "id": "", "text": "请选择" });
		max_sensitive_levelJSON.unshift({ "id": "", "text": "请选择" });
		businesstypeJSON.unshift({ "id": "", "text": "请选择" });
//		titleJSON.unshift({ "id": "", "text": "请选择" });
		
 		//查询部分
		$('#group_user_query_user_win_query_sex').combobox({
			data : sexJSON,
			valueField:'id',
			textField:'text',
			editable:false
		});
		$('#group_user_query_user_win_query_police_type').combobox({
			data : police_typeJSON,
			valueField:'id',
			textField:'text',
			editable:false
		});
// 		$('#group_user_query_user_win_query_police_num').combobox({
// 			data : police_numJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 		});
		$('#group_user_query_user_win_query_max_sensitive_level').combobox({
			data : max_sensitive_levelJSON,
			valueField:'id',
			textField:'text',
			editable:false
		});
		$('#group_user_query_user_win_query_businesstype').combobox({
			data : businesstypeJSON,
			valueField:'id',
			textField:'text',
			editable:false
		});
// 		$('#group_user_query_user_win_query_title').combobox({
// 			data : titleJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 		});
		
	}, "json");	
});
</script>	
  </body>
</html>
