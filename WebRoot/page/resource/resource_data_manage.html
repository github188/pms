<!DOCTYPE html>
<html>
  <head>
    <title>resource_data_manage.html</title>
	
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    
    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->

  </head>
  
  <body>
	<div class="easyui-layout" data-options="fit:true,border:false">
		<div region="north" data-options="split:false,border:true"  style="height:45px;line-height:42px;padding-left:5px;background: url(../images/white-top-bottom.gif) repeat-x;">
			<b>当前位置：<span style="color:blue">数据资源管理</span></b>
		</div>
		<div id="content" region="center" data-options="border:true,noheader:true" style="padding:3px;">
			<div id="resource_data_manage_center_main_wapper" class="easyui-panel" data-options="border:false,fit:true">
		    	<div id="resource_data_manage_center_main" class="easyui-layout" data-options="fit:true" >
		    		<div id="resource_data_manage_center_query" region="north" data-options="border:false,noheader:true" style="margin-bottom:5px;">
		    			<table class="nodt" style="width:100%">
			                <tr>
			                    <td class="query_name_small text_right">名称</td>
			                    <td class="query_value_small"><input id="resource_data_query_name" class="easyui-textbox"></input></td>
			                    <td class="query_name_small text_right">编码</td>
			                    <td class="query_value_small"><input id="resource_data_query_code" class="easyui-textbox"></input></td>
			                    <td>
			                    	<a href="javascript:void(0)" class="easyui-linkbutton" onclick="queryResourceData()">查询</a>
	            					<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearQueryOrgCondition()">重置</a>
			                    </td>
			                </tr>
			            </table>
		    		</div><!-- end of resource_data_manage_center_query -->
		    		
		    		<div id="resource_data_manage_center_list" region="center" data-options="border:false,noheader:true" >
		    			<table class="nodt" id="resource_data_manage_center_list_dg"  
					            data-options="singleSelect:false,method:'post',nowrap:true,toolbar:'#toolbar',pagination:true,noheader:true,fit:true">
					        <thead>
					            <tr>
					            	<th field="ck" checkbox="true"></th>
					                <th data-options="field:'name'" style="width:33%;">名称</th>
					                <th data-options="field:'RESOURCE_ID'" style="width:33%;">编码</th>
					                <th data-options="field:'RESOURCE_DESCRIBE'" style="width:33%;">描述</th>
					            </tr>
					        </thead>
					    </table>
					    <div id="toolbar" style="background-color:#E7F0FF">
					    	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add',plain:true" onclick="addResourceData()">添加</a>
<!-- 	            			<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit',plain:true" onclick="modResourceData()">修改</a> -->
	            			<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove',plain:true" onclick="delResourceData()">删除</a>
					    </div><!-- end of toolbar -->
		    		</div><!-- end of resource_data_manage_center_list -->
		    		
		    	</div><!-- end of resource_data_manage_center_main -->


			</div><!-- resource_data_manage_center_main_wapper -->			
			
			<div id="permissionControl_resource_data_manage_center_detail_wapper" 
					style="width:320px;height:150px;" data-options="title:'提示',draggable:false,inline:true,modal:true,resizable:false,closable:false,collapsible:false,minimizable:false,maximizable:false">
				<table>	
					<tr><td>
			    		请选择权限控制类型：
			    	</td></tr>
			    	<tr><td align=center>
			    		<a href="javascript:void(0)" class="easyui-linkbutton" onclick="permissionControl('column_relation')">字段权限控制</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="permissionControl('classify_relation')">字段分类关系权限控制</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="permissionControl('row_relation')">行权限控制</a>
			    	</td></tr>									
				</table>
			</div>
			
			<div id="resource_data_manage_center_detail_wapper" class="easyui-panel" data-options="fit:true,closed:true" >
				<div id="resource_data_manage_center_detail" class="easyui-panel" 
								data-options="fit:true,border:false,title:'基本信息',footer:'#resource_data_manage_center_detail_ft'" >
					<div id="message" style="width=100%;height:30px;text-align:center;line-height:30px;display:none"></div>
				    <form id="resource_data_manage_center_detail_form" method="post">
				    	<input id="res_id" name="data.id" type="hidden"/>
				    	<input id="res_data_version" name="data.DATA_VERSION" type="hidden"/>
				    	<input id="resDataOrg_data_version" name="resDataOrg.DATA_VERSION" type="hidden"/>
				        <table class="nodt" style="width:100%">
				            <tr>
				                <td class="form_name_small text_right"><span style="color:red;">*</span> 名称</td>
				                <td><input id="res_name" name="data.name" class="form_value_mid easyui-textbox" data-options="prompt:'请输入资源名称'"></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"><span style="color:red;">*</span> 资源唯一标识</td>
				                <td><input id="res_resid" name="data.RESOURCE_ID" class="form_value_mid easyui-textbox" data-options="prompt:'请输入资源唯一标识',editable:false""></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 资源状态</td>
				                <td><input id="res_status" name="data.RESOURCE_STATUS" class="form_value_mid easyui-textbox" data-options="prompt:'请输资源状态'"></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 资源描述</td>
				                <td><input id="res_desc" name="data.RESOURCE_DESCRIBE" class="form_value_mid easyui-textbox" data-options="prompt:'请输入资源描述'"></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 备注</td>
				                <td><input id="res_memo" name="data.RMK" class="form_value_mid easyui-textbox" data-options="prompt:'请输入备注'"></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 删除状态</td>
				                <td><input id="res_delstatus" name="data.DELETE_STATUS" class="form_value_mid easyui-textbox" data-options="prompt:'请选择删除状态'"></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 资源类型</td>
				                <td><input id="res_type" name="data.resource_type" class="form_value_mid easyui-textbox" data-options="prompt:'请输入资源类型'"></input></td>
				            </tr>
				            <tr>
				             	<td class="form_name_small text_right"> 目标地市</td>
				                <td><input id="resOrg_dest" name="resDataOrg.CLUE_DST_SYS" class="form_value_mid easyui-textbox" data-options="prompt:'请选择目标地市',editable:false"></input>
			                		<a href="javascript:void(0)" id="openOrgSelectWin_linkbutton" class="easyui-linkbutton" data-options="iconCls:'icon-save',disabled: true" onclick="openOrgSelectWin()">选择</a>
								</td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 数据集编码</td>
				                <td><input id="res_dataset" name="data.DATA_SET" class="form_value_mid easyui-textbox" data-options="prompt:'请输入数据集编码'"></input></td>
				            </tr>
				            <tr>
				                <td class="form_name_small text_right"> 数据集敏感度编码</td>
				                <td><input id="res_dsl" name="data.DATASET_SENSITIVE_LEVEL" class="form_value_mid easyui-textbox" data-options="prompt:'请输入数据集敏感度编码',disabled: true"></input></td>
				            </tr>
				            <tr id="permissionControl_sectionclass">
				                <td class="form_name_small text_right"> 字段分类编码</td>
				                <td><input id="res_sectionclass" name="data.SECTION_CLASS" class="form_value_mid easyui-textbox" data-options="prompt:'请输入字段分类编码',disabled: true"></input></td>
				            </tr>
				            <tr id="permissionControl_element">
				                <td class="form_name_small text_right"> 字段编码</td>
				                <td><input id="res_element" name="data.ELEMENT" class="form_value_mid easyui-textbox" data-options="prompt:'请输入字段编码',disabled: true"></input></td>
				            </tr>
				            <tr id="permissionControl_secrelacls">
				                <td class="form_name_small text_right"> 字段分类关系编码</td>
				                <td><input id="res_secrelacls" name="data.SECTION_RELATIOIN_CLASS" class="form_value_mid easyui-textbox" data-options="prompt:'请输入字段分类关系编码',disabled: true"></input></td>
				            </tr>
				            <tr id="permissionControl_operatesymbol">
				                <td class="form_name_small text_right"> 操作符</td>
				                <td><input id="res_operatesymbol" name="data.OPERATE_SYMBOL" class="form_value_mid easyui-textbox" data-options="prompt:'请输入操作符'"></input></td>
				            </tr>
				            <tr id="permissionControl_elementvalue">
				                <td class="form_name_small text_right"> 字段值</td>
				                <td><input id="res_elementvalue" name="data.ELEMENT_VALUE" class="form_value_mid easyui-textbox" data-options="prompt:'请输入字段值',disabled: true"></input></td>
				            </tr>
				        </table>
				    </form>
				    
				    <div id="org_query_win" class="easyui-window" title="组织机构" style="width:90%;height:90%;"
				    		data-options="iconCls:'icon-save',draggable:false,inline:true,modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false" >
				        <div class="easyui-layout" data-options="fit:true">
				            <div data-options="region:'west',split:false" style="width:200px">
				            	<div class="easyui-panel" data-options="fit:true,border:true,noheader:true">
						        <ul id="org_query_tree" class="easyui-tree" data-options="url:'../organization/queryChildrenNodes.action'">
						        </ul><!-- end of org_query_tree -->
						        </div>
				            </div><!-- end of west -->
				            <div data-options="region:'center'">
				                <div class="easyui-panel" data-options="fit:true,border:true,noheader:true">
				                	<table class="nodt" id="org_query_list_dg"  
							            data-options="singleSelect:true,method:'post',nowrap:true,idField:'id',toolbar:'#org_query_list_dg_tb',pagination:true,noheader:true,fit:true">
								        <thead>
								            <tr>
								                <th data-options="field:'name'" style="width:33%;">机构名称</th>
								                <th data-options="field:'id'" style="width:33%;">机构编码</th>
								                <th data-options="field:'pname'" style="width:33%;">上级机构</th>
								            </tr>
								        </thead>
								    </table>
								    <div id="org_query_list_dg_tb" style="background-color:#E7F0FF">
								    	<table class="nodt" style="width:100%">
							                <tr>
							                    <td class="query_name_small text_right noborder" style="border:0;">机构名称</td>
							                    <td class="query_value_small noborder" style="border:0;"><input id="org_query_win_name" class="easyui-textbox"></input></td>
							                    <td class="query_name_small text_right noborder" style="border:0;">机构编码</td>
							                    <td class="query_value_small noborder" style="border:0;"><input id="org_query_win_uid" class="easyui-textbox"></input></td>
							                    <td class="text_right noborder" style="border:0;">
							                    	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="orgQueryWinQueryOrg()">查询</a>
							                    	<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="orgQueryWinClearQueryOrgCondition()">重置</a>
							                    </td>
							                </tr>
							            </table>
								    </div><!-- end of toolbar -->
				                </div>
				            </div><!-- end of center -->
				        </div>
				    </div><!-- end of org_query_win -->
				    
				</div><!-- end of resource_data_manage_center_detail -->
				<div id="resource_data_manage_center_detail_ft" style="text-align:center;height:45px;padding-top:15px;">
					<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="addDataSave();">保存</a>
					<a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="addDataReturn();">返回</a>
				</div><!-- end of resource_data_manage_center_detail_ft -->
	    	</div><!-- end of resource_data_manage_center_detail_wapper -->
		</div>
	
	</div><!-- end of layout -->
<script>
    function queryResourceData(){
    	var name = $("#resource_data_query_name").val();
    	var code = $("#resource_data_query_code").val();
     	
    	$("#resource_data_manage_center_list_dg").datagrid('load',{
    		queryAll: true,
			resName: name,
			resCode: code
		});
    }
    
    function clearQueryOrgCondition(){
    	$("#resource_data_query_name").textbox({value:""});
    	$("#resource_data_query_code").textbox({value:""});
    }
    
    function openOrgSelectWin(){
    	$('#org_query_win').window('open').window('center');
    }
    
    function orgQueryWinClearQueryOrgCondition(){
    	$("#org_query_win_name").textbox({value:""});
    	$("#org_query_win_uid").textbox({value:""});
    }
    
    function orgQueryWinQueryOrg(){
    	var name = $("#org_query_win_name").val();
    	var uid = $("#org_query_win_uid").val();
    	
    	$("#org_query_list_dg").datagrid('load',{
    		queryAll: true,
			id: 0,
			orgName: name,
			orgUid: uid
		});
    }
       
    function addResourceData() {
    	$('#permissionControl_resource_data_manage_center_detail_wapper').window({});
    	$("#resource_data_manage_center_main_wapper").panel('close');
    	$("#res_status").combobox('select', '开启');
    	$("#res_status").textbox({ disabled: true});
    	$("#res_delstatus").combobox('select', '未删除');
    	$("#res_delstatus").textbox({ disabled: true});
    }
    
    function addDataSave(){
		// submit the form
		$("#resource_data_manage_center_detail_form").submit();
    }
    
    function addDataReturn(){
    	$("#resource_data_manage_center_main_wapper").panel('open');
    	$("#resource_data_manage_center_main_wapper").panel('resize');
    	$("#resource_data_manage_center_detail_wapper").panel('close');
    	$("#resource_data_manage_center_list_dg").datagrid('reload').datagrid('clearSelections');
    	refreshDetailPage();
    }
    
    function refreshDetailPage() {
		$("#res_id").val("");
		$("#res_data_version").val("");
		$("#resDataOrg_data_version").val("");
     	$("#res_name").textbox('setValue',"");
     	$("#res_resid").textbox('setValue',"");
     	$("#res_status").textbox('setValue',"");
     	$("#res_desc").textbox('setValue',"");
     	$("#res_memo").textbox('setValue',"");
     	$("#res_delstatus").textbox('setValue',"");
     	$("#res_type").textbox('setValue',"");
     	$("#res_type").textbox({ disabled: false});
		$("#openOrgSelectWin_linkbutton").linkbutton({ disabled: true});
     	$("#resOrg_dest").textbox('setValue',"");
     	$("#res_dsl").textbox('setValue',"");
     	$("#res_dsl").textbox({ disabled: true});
     	$("#res_dataset").textbox('setValue',"");
     	$("#res_sectionclass").textbox('setValue',"");
     	$("#res_sectionclass").textbox({ disabled: true});
     	$("#res_element").textbox('setValue',"");
     	$("#res_element").textbox({ disabled: true});
     	$("#res_secrelacls").textbox('setValue',"");
     	$("#res_secrelacls").textbox({ disabled: true});
     	
     	$("#permissionControl_sectionclass").show();
		$("#permissionControl_element").show();
		$("#permissionControl_secrelacls").show();
		$("#permissionControl_operatesymbol").show();
		$("#permissionControl_elementvalue").show();
    }
    
    function modResourceData(){
    	var rows = $("#resource_data_manage_center_list_dg").datagrid('getSelections');
		if(rows.length == 0) {
			warningTip("提示", '请选择要修改的资源');
			return false;
		} else if (rows.length>1)
		{
			warningTip("提示", '一次只能修改一个资源');
			return false;
		}
		
		$("#res_id").val(rows[0].id);
		$("#res_data_version").val(rows[0].DATA_VERSION);
		$("#resDataOrg_data_version").val(rows[0].dest_data_version);
		$("#res_name").textbox('setValue',rows[0].name);
		$("#res_resid").textbox('setValue',rows[0].RESOURCE_ID);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 7 && rows[0].dictionary[i].value == rows[0].RESOURCE_STATUS){//资源状态attrid==7
				$("#res_status").textbox('setValue',rows[0].dictionary[i].code);	
			}
		};
		$("#res_status").textbox('setText',rows[0].RESOURCE_STATUS);
		$("#res_desc").textbox('setValue',rows[0].RESOURCE_DESCRIBE);
		$("#res_memo").textbox('setValue',rows[0].RMK);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 8 && rows[0].dictionary[i].value == rows[0].DELETE_STATUS){//删除状态attrid==8
				$("#res_delstatus").textbox('setValue',rows[0].dictionary[i].code);	
			}
		};
		$("#res_delstatus").textbox('setText',rows[0].DELETE_STATUS);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 9 && rows[0].dictionary[i].value == rows[0].resource_type){//资源类型attrid==9
				$("#res_type").textbox('setValue',rows[0].dictionary[i].code);
			}
		};
		$("#res_type").textbox('setText',rows[0].resource_type);
		$("#res_type").textbox({ disabled: true});
		$('#openOrgSelectWin_linkbutton').linkbutton({ disabled: true});
// 		$("#resOrg_dest").textbox('setValue',rows[0].CLUE_DST_SYS);
		$("#resOrg_dest").textbox('setValue',rows[0].pid);
		$("#resOrg_dest").textbox('setText',rows[0].pname);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 10 && rows[0].dictionary[i].value == rows[0].DATASET_SENSITIVE_LEVEL){//数据集敏感度编码attrid==10
				$("#res_dsl").textbox('setValue',rows[0].dictionary[i].code);
			}
		};
		$("#res_dsl").textbox('setText',rows[0].DATASET_SENSITIVE_LEVEL);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 11 && rows[0].dictionary[i].value == rows[0].DATA_SET){//数据集编码attrid==11
				$("#res_dataset").textbox('setValue',rows[0].dictionary[i].code);
			}
		};
		$("#res_dataset").textbox('setText',rows[0].DATA_SET);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 12 && rows[0].dictionary[i].value == rows[0].SECTION_CLASS){//字段分类编码attrid==12
				$("#res_sectionclass").textbox('setValue',rows[0].dictionary[i].code);
			}
		};
		$("#res_sectionclass").textbox('setText',rows[0].SECTION_CLASS);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 13 && rows[0].dictionary[i].value == rows[0].ELEMENT){//字段编码attrid==13
				$("#res_element").textbox('setValue',rows[0].dictionary[i].code);
			}
		};
		$("#res_element").textbox('setText',rows[0].ELEMENT);
		for(var i=0;i<rows[0].dictionary.length;i++){
			if(rows[0].dictionary[i].attrid == 14 && rows[0].dictionary[i].value == rows[0].SECTION_RELATIOIN_CLASS){//字段分类关系编码attrid==14
				$("#res_secrelacls").textbox('setValue',rows[0].dictionary[i].code);
			}
		};
		$("#res_secrelacls").textbox('setText',rows[0].SECTION_RELATIOIN_CLASS);
		
		$("#resource_data_manage_center_main_wapper").panel('close');
		$('#permissionControl_resource_data_manage_center_detail_wapper').window({});
		$("#permissionControl_resource_data_manage_center_detail_wapper").window('close');
		var element = $("#res_element").combobox('getValue');
		var secrelacls = $("#res_secrelacls").combobox('getValue');
		var operatesymbol = $("#res_operatesymbol").combobox('getValue');
		var elementvalue = $("#res_elementvalue").combobox('getValue');
		
    	$("#resource_data_manage_center_detail_wapper").panel('open');
    }
    
    function permissionControl(relation){
    	if(relation=='column_relation'){
	    	$("#permissionControl_secrelacls").hide();
	    	$("#permissionControl_operatesymbol").hide();
	    	$("#permissionControl_elementvalue").hide();
		    $.post("../dataresource/queryRowDataSets.action", function(data) {
				var data_set="";			//数据集编码
				for(var i=0;i<data.resDataSet.length;i++){
					data_set+= "{id:'"+data.resDataSet[i].DATA_SET+"',text:'"+data.resDataSet[i].DATASET_NAME+"'},"; 
				};
		 		var data_setData='([' + data_set.substring(0,data_set.length-1) + '])';
		 		var data_setJSON = (new Function('return '+data_setData +';'))(); 
				data_setJSON.unshift({"id":"","text":"请选择","selected":true});
				
				$('#res_dataset').combobox({
					data : data_setJSON,
					valueField:'id',
					textField:'text',
					editable:false,
					onChange:function(){  
				    	var dataset = $("#res_dataset").combobox("getValues");
				    	if(dataset == ''){
				    		$("#res_dsl").textbox({value:""});
							$('#res_dsl').textbox({ disabled: true});
							$("#res_sectionclass").textbox({value:""});
							$('#res_sectionclass').textbox({ disabled: true});
		    			}else{
		    				var poststr = "dataSet=" + dataset;
		    					
		    				$.post("../dataresource/queryDataSetSensitive.action", poststr, function(data) {
			    				var dataset_sensitive_level="";			//数据集敏感度编码
								for(var i=0;i<data.resDataSetSensitive.length;i++){
									dataset_sensitive_level+= "{id:'"+data.resDataSetSensitive[i].DATASET_SENSITIVE_LEVEL+"',text:'"+data.resDataSetSensitive[i].DATASET_SENSITIVE_NAME+"'},"; 
								};
								var dataset_sensitive_levelData='([' + dataset_sensitive_level.substring(0,dataset_sensitive_level.length-1) + '])';
							 	var dataset_sensitive_levelJSON = (new Function('return '+dataset_sensitive_levelData +';'))(); 
								dataset_sensitive_levelJSON.unshift({"id":"","text":"请选择","selected":true});
								
			    				$('#res_dsl').combobox({
									data : dataset_sensitive_levelJSON,
									valueField:'id',
									textField:'text',
									editable:false
								});
								if (data.resDataSetSensitive.length = 1) {
				                  $('#res_dsl').combobox('select', data.resDataSetSensitive[0].DATASET_SENSITIVE_LEVEL);
					            } 
							});
							
							$.post("../dataresource/queryColumnClassify.action", poststr, function(data) {
			    				var section_class="";			//字段分类编码
								for(var i=0;i<data.resColumnClassify.length;i++){
									section_class+= "{id:'"+data.resColumnClassify[i].SECTION_CLASS+"',text:'"+data.resColumnClassify[i].CLASSIFY_NAME+"'},"; 
								};
								var section_classData='([' + section_class.substring(0,section_class.length-1) + '])';
							 	var section_classJSON = (new Function('return '+section_classData +';'))(); 
								section_classJSON.unshift({"id":"","text":"请选择","selected":true});
								
			    				$('#res_sectionclass').combobox({
									data : section_classJSON,
									valueField:'id',
									textField:'text',
									editable:false,
									disabled: false,
									onChange:function(){
										var section_class = $("#res_sectionclass").combobox("getValues");
								    	if(section_class == ''){
											$("#res_element").textbox({value:""});
											$('#res_element').textbox({ disabled: true});
						    			}else{
						    				poststr = "dataSet=" + dataset+"&sectionClass=" + section_class;
						    				
						    				$.post("../dataresource/queryColumnColumn.action", poststr, function(data) {
							    				var element="";			//字段编码
												for(var i=0;i<data.resColumn.length;i++){
													element+= "{id:'"+data.resColumn[i].ELEMENT+"',text:'"+data.resColumn[i].COLUMU_CN+"'},"; 
												};	
												var elementData='([' + element.substring(0,element.length-1) + '])';
											 	var elementJSON = (new Function('return '+elementData +';'))(); 		 	
												elementJSON.unshift({"id":"","text":"请选择","selected":true});
												
							    				$('#res_element').combobox({
													data : elementJSON,
													valueField:'id',
													textField:'text',
													editable:false,
													disabled: false
												});
											});
					    			
						    			}
									}
								});
							});			
							
		    			}
		    		}
				});
			});
    	}else if(relation=='classify_relation'){
    		$("#permissionControl_sectionclass").hide();
    		$("#permissionControl_element").hide();
	    	$("#permissionControl_operatesymbol").hide();
	    	$("#permissionControl_elementvalue").hide();
	    	$.post("../dataresource/queryClassifyDataSets.action", function(data) {
				var data_set="";			//数据集编码
				for(var i=0;i<data.resDataSet.length;i++){
					data_set+= "{id:'"+data.resDataSet[i].DATA_SET+"',text:'"+data.resDataSet[i].DATASET_NAME+"'},"; 
				};
		 		var data_setData='([' + data_set.substring(0,data_set.length-1) + '])';
		 		var data_setJSON = (new Function('return '+data_setData +';'))(); 
				data_setJSON.unshift({"id":"","text":"请选择","selected":true});
				
				$('#res_dataset').combobox({
					data : data_setJSON,
					valueField:'id',
					textField:'text',
					editable:false,
					onChange:function(){  
				    	var dataset = $("#res_dataset").combobox("getValues");
				    	if(dataset == ''){
				    		$("#res_dsl").textbox({value:""});
							$('#res_dsl').textbox({ disabled: true});
							$("#res_secrelacls").textbox({value:""});
							$('#res_secrelacls').textbox({ disabled: true});
		    			}else{
		    				var poststr = "dataSet=" + dataset;
		    					
		    				$.post("../dataresource/queryDataSetSensitive.action", poststr, function(data) {
			    				var dataset_sensitive_level="";			//数据集敏感度编码
								for(var i=0;i<data.resDataSetSensitive.length;i++){
									dataset_sensitive_level+= "{id:'"+data.resDataSetSensitive[i].DATASET_SENSITIVE_LEVEL+"',text:'"+data.resDataSetSensitive[i].DATASET_SENSITIVE_NAME+"'},"; 
								};
								var dataset_sensitive_levelData='([' + dataset_sensitive_level.substring(0,dataset_sensitive_level.length-1) + '])';
							 	var dataset_sensitive_levelJSON = (new Function('return '+dataset_sensitive_levelData +';'))(); 
								dataset_sensitive_levelJSON.unshift({"id":"","text":"请选择","selected":true});
								
			    				$('#res_dsl').combobox({
									data : dataset_sensitive_levelJSON,
									valueField:'id',
									textField:'text',
									editable:false
								});
								if (data.resDataSetSensitive.length = 1) {
				                  $('#res_dsl').combobox('select', data.resDataSetSensitive[0].DATASET_SENSITIVE_LEVEL);
					            } 
							});
							
							$.post("../dataresource/qeryResRelationClassify.action", poststr, function(data) {
			    				var section_relation_class="";			//字段分类关系编码
								for(var i=0;i<data.resRelationClassify.length;i++){
									section_relation_class+= "{id:'"+data.resRelationClassify[i].SECTION_RELATIOIN_CLASS+"',text:'"+data.resRelationClassify[i].SECTION_RELATIOIN_CLASS_NAME+"'},"; 
								};
								var section_relation_classData='([' + section_relation_class.substring(0,section_relation_class.length-1) + '])';
							 	var section_relation_classJSON = (new Function('return '+section_relation_classData +';'))(); 
								section_relation_classJSON.unshift({"id":"","text":"请选择","selected":true});
								
			    				$('#res_secrelacls').combobox({
									data : section_relation_classJSON,
									valueField:'id',
									textField:'text',
									editable:false,
									disabled: false
								});
							});			
							
		    			}
		    		}
				});
			});
    	}else if(relation=='row_relation'){
    		$("#permissionControl_sectionclass").hide();
    		$("#permissionControl_secrelacls").hide();
    		
		    $.post("../dataresource/queryRowDataSets.action", function(data) {
				var data_set="";			//数据集编码
				for(var i=0;i<data.resDataSet.length;i++){
					data_set+= "{id:'"+data.resDataSet[i].DATA_SET+"',text:'"+data.resDataSet[i].DATASET_NAME+"'},"; 
				};
		 		var data_setData='([' + data_set.substring(0,data_set.length-1) + '])';
		 		var data_setJSON = (new Function('return '+data_setData +';'))(); 
				data_setJSON.unshift({"id":"","text":"请选择","selected":true});
				
				$('#res_dataset').combobox({
					data : data_setJSON,
					valueField:'id',
					textField:'text',
					editable:false,
					onChange:function(){  
				    	var dataset = $("#res_dataset").combobox("getValues");
				    	if(dataset == ''){
				    		$("#res_dsl").textbox({value:""});
							$('#res_dsl').textbox({ disabled: true});
							$("#res_element").textbox({value:""});
							$('#res_element').textbox({ disabled: true});
		    			}else{
		    				var poststr = "dataSet=" + dataset;
		    					
		    				$.post("../dataresource/queryDataSetSensitive.action", poststr, function(data) {
			    				var dataset_sensitive_level="";			//数据集敏感度编码
								for(var i=0;i<data.resDataSetSensitive.length;i++){
									dataset_sensitive_level+= "{id:'"+data.resDataSetSensitive[i].DATASET_SENSITIVE_LEVEL+"',text:'"+data.resDataSetSensitive[i].DATASET_SENSITIVE_NAME+"'},"; 
								};
								var dataset_sensitive_levelData='([' + dataset_sensitive_level.substring(0,dataset_sensitive_level.length-1) + '])';
							 	var dataset_sensitive_levelJSON = (new Function('return '+dataset_sensitive_levelData +';'))(); 
								dataset_sensitive_levelJSON.unshift({"id":"","text":"请选择","selected":true});
								
			    				$('#res_dsl').combobox({
									data : dataset_sensitive_levelJSON,
									valueField:'id',
									textField:'text',
									editable:false
								});
								if (data.resDataSetSensitive.length = 1) {
				                  $('#res_dsl').combobox('select', data.resDataSetSensitive[0].DATASET_SENSITIVE_LEVEL);
					            } 
							});
							
							$.post("../dataresource/queryRowColumn.action", poststr, function(data) {
			    				var element="";			//字段编码
								for(var i=0;i<data.resColumn.length;i++){
									element+= "{id:'"+data.resColumn[i].ELEMENT+"',text:'"+data.resColumn[i].COLUMU_CN+"'},"; 
								};	
								var elementData='([' + element.substring(0,element.length-1) + '])';
							 	var elementJSON = (new Function('return '+elementData +';'))(); 		 	
								elementJSON.unshift({"id":"","text":"请选择","selected":true});
								
			    				$('#res_element').combobox({
									data : elementJSON,
									valueField:'id',
									textField:'text',
									editable:false,
									disabled: false,
									onChange:function(){
										var element = $("#res_element").combobox("getValues");
								    	if(element == ''){
								    		$("#res_elementvalue").textbox({value:""});
											$('#res_elementvalue').textbox({ disabled: true});
						    			}else{
						    				poststr = "dataSet=" + dataset+"&element=" + element;
						    				
							    			$.post("../dataresource/queryRowResValue.action", poststr, function(data) {
							    				var element_value="";			//字段值
												for(var i=0;i<data.resValue.length;i++){
													element_value+= "{id:'"+data.resValue[i].ELEMENT_VALUE+"',text:'"+data.resValue[i].VALUE_NAME+"'},"; 
												};
												var element_valueData='([' + element_value.substring(0,element_value.length-1) + '])';
											 	var element_valueJSON = (new Function('return '+element_valueData +';'))(); 
												element_valueJSON.unshift({"id":"","text":"请选择","selected":true});
												
							    				$('#res_elementvalue').combobox({
													data : element_valueJSON,
													valueField:'id',
													textField:'text',
													editable:false,
													disabled: false
												});
											});
						    			
						    			}
									}
								});
							});
							
							
		    			}
		    		}
				});
			});
    	}
    	
    	$("#permissionControl_resource_data_manage_center_detail_wapper").window('close');
    	$("#resource_data_manage_center_detail_wapper").panel('open');
    }
    
    function delResourceData(){
		var rows = $("#resource_data_manage_center_list_dg").datagrid('getSelections');
		if(rows.length == 0) {
			warningTip("提示", '请选择要删除的资源');
			return;
		}
		else {
			$.extend($.messager.defaults,{  
				ok:"删除",  
				cancel:"取消"  
			});
			$.messager.confirm('确认', '您选取了' + rows.length + '条记录。确认要删除所选资源？', function(r){
                if (r){
                	var poststr = "delIds=" + rows[0].id;
                	for(var i=1; i<rows.length; i++){
					    poststr += "&delIds=" + rows[i].id;
					}

                    $.post("../resource/deleteResourceDatas.action", poststr, function(retObj) {
		
						if(retObj.result == true)
						{
							$('#resource_data_manage_center_list_dg').datagrid('reload').datagrid('clearSelections');
							successTip("删除数据资源","操作成功");
						}
						else
						{
							warningTip("提示", '删除数据资源操作失败：' + retObj.message);
						}
					}, "json");
                }
            });
		}
	}
	
$(document).ready(function () { 
	
	$("#resource_data_manage_center_list_dg").datagrid({
		url:'../resource/queryDataItems.action',
		loadFilter: function(data){
			var res = new Object();
			if (data.result == true){
				res.total = data.total;
				res.rows = data.dataItems;
			} else {
				res.total=0;
				res.rows = [];
			}
			return res;
		},
//		onLoadSuccess: function() {alert("success");},
		onLoadError: function() { $("#resource_data_manage_center_main").layout('resize',{width:'100%',height:'100%'}); }
	});
	$('#org_query_tree').tree({
	    loadFilter: function(data){
	        if (data.treeNodes){
	            return data.treeNodes;
	        } else {
	            return data;
	        }
	    },
	    onClick: function(node){
	    	//alert(node.id);
			$("#resOrg_dest").textbox('setValue',node.id);
			$("#resOrg_dest").textbox('setText',node.text);
			$('#org_query_win').window('close');
	    }
	});
	
	$("#org_query_list_dg").datagrid({
		url:'../organization/queryChildrenItems.action',
		queryParams:{queryAll: true},
		loadFilter: function(data){
			var res = new Object();
			if (data.result == true){
				res.total = data.total;
				res.rows = data.items;
			} else {
				res.total=0;
				res.rows = [];
			}
			return res;
		},
		onSelect: function(index,row) {
			$("#resOrg_dest").textbox('setValue',row.id);
			$("#resOrg_dest").textbox('setText',row.name);
			$('#org_query_win').window('close');
		},
//		onLoadSuccess: function() {alert("success");},
		onLoadError: function() { $("#org_query_list_dg").layout('resize',{width:'100%',height:'100%'}); }
	});
		
	$("#resource_data_manage_center_detail_form").form({
	    url:'../resource/saveResourceData.action',
	    success:function(data){
		    var recive = $.parseJSON(data);
			
	        if(recive.result == false) {
	        	warningTip("保存数据资源信息失败："+recive.message);
	        } else {
	        	successTip("保存数据资源信息","保存成功");

	        	addDataReturn();
	        }
	    }
	});
	
	$.post("../system/queryResourceDataAttrs.action", function(data) {
		var resource_status="";				//资源状态
		var delete_status="";				//删除状态
		var resource_type="";				//资源类型
// 		var dataset_sensitive_level="";		//数据集敏感度编码
// 		var data_set="";					//数据集编码
// 		var section_class="";				//字段分类编码
// 		var element="";						//字段编码
// 		var section_relation_class="";		//字段分类关系编码

		for( var index in data.items ) {
			for(var i=0;i<data.items[index].dictionary.length;i++){
				if( "RESOURCE_STATUS" == data.items[index].code ) {
					resource_status+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
				}
				else if( "DELETE_STATUS" == data.items[index].code ) {
					delete_status+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
				}
				else if( "resource_type" == data.items[index].code ) {
					resource_type+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
				}
// 				else if( "DATASET_SENSITIVE_LEVEL" == data.items[index].code ) {
// 					dataset_sensitive_level+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
// 				}
// 				else if( "DATA_SET" == data.items[index].code ) {
// 					data_set+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
// 				}
// 				else if( "SECTION_CLASS" == data.items[index].code ) {
// 					section_class+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
// 				}
// 				else if( "ELEMENT" == data.items[index].code ) {
// 					element+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
// 				}
// 				else if( "SECTION_RELATIOIN_CLASS" == data.items[index].code ) {
// 					section_relation_class+= "{id:'"+data.items[index].dictionary[i].code+"',text:'"+data.items[index].dictionary[i].value+"'},"; 
// 				}
			}
		}

		var resource_statusData='([' + resource_status.substring(0,resource_status.length-1) + '])';
 		var resource_statusJSON = (new Function('return '+resource_statusData +';'))();
 		var delete_statusData='([' + delete_status.substring(0,delete_status.length-1) + '])';
 		var delete_statusJSON = (new Function('return '+delete_statusData +';'))();
 		var resource_typeData='([' + resource_type.substring(0,resource_type.length-1) + '])';
 		var resource_typeJSON = (new Function('return '+resource_typeData +';'))(); 
//  		var dataset_sensitive_levelData='([' + dataset_sensitive_level.substring(0,dataset_sensitive_level.length-1) + '])';
//  		var dataset_sensitive_levelJSON = (new Function('return '+dataset_sensitive_levelData +';'))(); 
//  		var data_setData='([' + data_set.substring(0,data_set.length-1) + '])';
//  		var data_setJSON = (new Function('return '+data_setData +';'))(); 
//  		var section_classData='([' + section_class.substring(0,section_class.length-1) + '])';
//  		var section_classJSON = (new Function('return '+section_classData +';'))();
//  		var elementData='([' + element.substring(0,element.length-1) + '])';
//  		var elementJSON = (new Function('return '+ elementData +';'))(); 
//  		var section_relation_classData='([' + section_relation_class.substring(0,section_relation_class.length-1) + '])';
//  		var section_relation_classJSON = (new Function('return '+section_relation_classData +';'))(); 
 		
 		resource_statusJSON.unshift({"id":"","text":"请选择","selected":true});
		delete_statusJSON.unshift({"id":"","text":"请选择","selected":true});
		resource_typeJSON.unshift({"id":"","text":"请选择","selected":true});
// 		dataset_sensitive_levelJSON.unshift({"id":"","text":"请选择","selected":true});
// 		data_setJSON.unshift({"id":"","text":"请选择","selected":true});
// 		section_classJSON.unshift({"id":"","text":"请选择","selected":true});
// 		elementJSON.unshift({"id":"","text":"请选择","selected":true});
// 		section_relation_classJSON.unshift({"id":"","text":"请选择","selected":true});
		
 		//添加部分
		$('#res_status').combobox({
			data : resource_statusJSON,
			valueField:'id',
			textField:'text',
			editable:false
		});
		$('#res_delstatus').combobox({
			data : delete_statusJSON,
			valueField:'id',
			textField:'text',
			editable:false
		});
		$('#res_type').combobox({
			data : resource_typeJSON,
			valueField:'id',
			textField:'text',
			editable:false,
			onChange:function(){  
		    	var roleType = $("#res_type").combobox("getValue");
		    	if(roleType != 2){
		    		$("#resOrg_dest").textbox({value:""});
					$('#openOrgSelectWin_linkbutton').linkbutton({ disabled: true});
    			}else{
    				$('#openOrgSelectWin_linkbutton').linkbutton({ disabled: false});
    			}
    		}
		});
// 		$('#res_dsl').combobox({
// 			data : dataset_sensitive_levelJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 		});
// 		$('#res_dataset').combobox({
// 			data : data_setJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 			onChange:function(){  
// 		    	var dataset = $("#res_dataset").combobox("getValues");
// 		    	if(dataset == ''){
// 		    		$("#res_dsl").textbox({value:""});
// 					$('#res_dsl').textbox({ disabled: true});
//     			}else{
//     				$('#res_dsl').textbox({ disabled: false});
//     			}
//     		}
// 		});
// 		$('#res_sectionclass').combobox({
// 			data : section_classJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 		});
// 		$('#res_element').combobox({
// 			data : data_setJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 			,
// 			onChange:function(){  
// 		    	var element = $("#res_element").combobox("getValue");
// 		    	if(element != ''){
// 		    		$("#res_secrelacls").textbox({value:""});
// 					$('#res_secrelacls').textbox({ disabled: true});
//     			}else{
//     				$('#res_secrelacls').textbox({ disabled: false});
//     			}
//     		}
// 		});
// 		$('#res_secrelacls').combobox({
// 			data : section_relation_classJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 			,
// 			onChange:function(){  
// 		    	var secrelacls = $("#res_secrelacls").combobox("getValue");
// 		    	if(secrelacls != ''){
// 		    		$("#res_element").textbox({value:""});
// 					$('#res_element').textbox({ disabled: true});
// 					$('#res_operatesymbol').textbox({ disabled: true});
// 					$('#res_elementvalue').textbox({ disabled: true});
//     			}else{
//     				$('#res_element').textbox({ disabled: false});
//     				$('#res_operatesymbol').textbox({ disabled: false});
//     				$('#res_elementvalue').textbox({ disabled: false});
//     			}
//     		}
// 		});
// 		$('#res_operatesymbol').combobox({
// 			data : section_classJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 			,
// 			onChange:function(){  
// 		    	var operatesymbol = $("#res_operatesymbol").combobox("getValues");
// 		    	var elementvalue = $("#res_elementvalue").combobox("getValues");
// 		    	if(operatesymbol != '' || elementvalue != ''){
// 		    		$("#res_secrelacls").textbox({value:""});
// 					$('#res_secrelacls').textbox({ disabled: true});
//     			}else{
//     				$('#res_secrelacls').textbox({ disabled: false});
//     			}
//     		}
// 		});
// 		$('#res_elementvalue').combobox({
// 			data : section_classJSON,
// 			valueField:'id',
// 			textField:'text',
// 			editable:false
// 			,
// 			onChange:function(){  
// 		    	var operatesymbol = $("#res_operatesymbol").combobox("getValues");
// 		    	var elementvalue = $("#res_elementvalue").combobox("getValues");
// 		    	if(operatesymbol != '' || elementvalue != ''){
// 		    		$("#res_secrelacls").textbox({value:""});
// 					$('#res_secrelacls').textbox({ disabled: true});
//     			}else{
//     				$('#res_secrelacls').textbox({ disabled: false});
//     			}
//     		}
			
// 		});
		
	}, "json");	
});
</script>	
  </body>
</html>
